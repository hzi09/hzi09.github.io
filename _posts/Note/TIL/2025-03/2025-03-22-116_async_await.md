---
title:  "[TIL] ë‚´ì¼ë°°ì›€ìº í”„ 116ì¼ì°¨_[async/await] ë™ê¸°ì™€ ë¹„ë™ê¸°: asyncì™€ await" 

categories: 
    - TIL
tags: 
    - TIL
    - ë‚´ì¼ë°°ì›€ìº í”„


toc: True
toc_sticky: True
---

![TIL](/assets/images/TIL2.png){: .align-center style="width:35%;"}

# ğŸ‘€Today I Learn
## ë™ê¸°ì™€ ë¹„ë™ê¸°
### 1. ë™ê¸°(Synchronous)

- ì½”ë“œê°€ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰ë¨
- ì´ì „ ì‘ì—…ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ë‹¤ìŒ ì‘ì—…ì´ ëŒ€ê¸°
- ì‹¤í–‰ íë¦„ì´ ì˜ˆì¸¡ ê°€ëŠ¥í•˜ì§€ë§Œ, í•˜ë‚˜ì˜ ì‘ì—…ì´ ì˜¤ë˜ ê±¸ë¦´ ê²½ìš° ì „ì²´ ì‘ë‹µ ì†ë„ê°€ ëŠë ¤ì§ˆ ìˆ˜ ìˆìŒ

### 2. ë¹„ë™ê¸°(Asynchronous)

- ì‘ì—…ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³  ë‹¤ìŒ ì‘ì—…ì„ ì§„í–‰
- ë³‘ë ¬ì ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆì–´ ì„±ëŠ¥ í–¥ìƒ ê°€ëŠ¥
- ì´ë²¤íŠ¸ ê¸°ë°˜ í”„ë¡œê·¸ë˜ë° ë°©ì‹ ì‚¬ìš©

<br>

## Pythonì—ì„œì˜ ë¹„ë™ê¸° ì²˜ë¦¬ ë°©ì‹

### 1. `async`ì™€ `await`

- Pythonì—ì„œëŠ” `async`ì™€ `await` í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë™ê¸° ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŒ
- `async` í•¨ìˆ˜ëŠ” í˜¸ì¶œ ì‹œ ì¦‰ì‹œ ì‹¤í–‰ë˜ì§€ ì•Šê³  `await` í‚¤ì›Œë“œê°€ ìˆëŠ” ì§€ì ì—ì„œ ë©ˆì¶”ì—ˆë‹¤ê°€, ì‹¤í–‰ì´ ì™„ë£Œë˜ë©´ ë‹¤ì‹œ ì§„í–‰ë¨
- ì˜ˆì œ
    
    ```python
    import asyncio
    
    async def my_async_function():
        print("Start")
        await asyncio.sleep(2)
        print("End")
    
    asyncio.run(my_async_function())
    ```
    

### 2. Multi-threading

- ì—¬ëŸ¬ ìŠ¤ë ˆë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë™ì‹œì— ì—¬ëŸ¬ ì‘ì—…ì„ ì‹¤í–‰
- Pythonì˜ `threading` ëª¨ë“ˆì„ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„
- GIL(Global Interpreter Lock) ë•Œë¬¸ì— CPU ì‘ì—…ë³´ë‹¤ëŠ” I/O ì‘ì—…ì— ì í•©
- ì˜ˆì œ
    
    ```python
    import threading
    import time
    
    def worker():
        print("Thread ì‹œì‘")
        time.sleep(2)
        print("Thread ì¢…ë£Œ")
    
    thread = threading.Thread(target=worker)
    thread.start()
    thread.join()
    ```
    

### 3. Multi-processing

- ì—¬ëŸ¬ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ë³‘ë ¬ë¡œ ì‘ì—… ìˆ˜í–‰
- `multiprocessing` ëª¨ë“ˆì„ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„
- GILì˜ ì˜í–¥ì„ ë°›ì§€ ì•Šì•„ CPU ì—°ì‚°ì´ ë§ì€ ì‘ì—…ì— ì í•©
- ì˜ˆì œ
    
    ```python
    import multiprocessing
    import time
    
    def worker():
        print("Process ì‹œì‘")
        time.sleep(2)
        print("Process ì¢…ë£Œ")
    
    process = multiprocessing.Process(target=worker)
    process.start()
    process.join()
    ```

<br> 

## Djangoì—ì„œì˜ ë¹„ë™ê¸° ì²˜ë¦¬ ë°©ì‹

### 1. Celery + Redis

- CeleryëŠ” ë¹„ë™ê¸° ì‘ì—…ì„ ì²˜ë¦¬í•˜ëŠ” ë¶„ì‚° ì‘ì—… í
- Redisë¥¼ ë°±ì—”ë“œë¡œ ì‚¬ìš©í•˜ì—¬ ì‘ì—…ì„ ì €ì¥í•˜ê³  ì‹¤í–‰

- ì„¤ì¹˜ ë° ì‹¤í–‰
    
    ```bash
    pip install celery redis
    ```
    
- `celery.py` ì„¤ì • (Django í”„ë¡œì íŠ¸ ë£¨íŠ¸)
    
    ```python
    import os
    from celery import Celery
    
    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'myproject.settings')
    
    celery_app = Celery('myproject')
    celery_app.config_from_object('django.conf:settings', namespace='CELERY')
    celery_app.autodiscover_tasks()
    ```
    
- íƒœìŠ¤í¬ ì •ì˜
    
    ```python
    from celery import shared_task
    import time
    
    @shared_task
    def my_task():
        time.sleep(5)
        return "ì‘ì—… ì™„ë£Œ"
    ```
    

### 2. `async`ì™€ `await`

- Django 3.1ë¶€í„° ì¼ë¶€ ë·°ì—ì„œ `async` ì§€ì› ê°€ëŠ¥
    
    ```python
    from django.http import JsonResponse
    import asyncio
    
    async def async_view(request):
        await asyncio.sleep(2)
        return JsonResponse({"message": "ë¹„ë™ê¸° ì‘ì—… ì™„ë£Œ"})
    ```
    
<br>

## Djangoì™€ Channels

### 1. ì›¹ì†Œì¼“(WebSocket)ì´ë€?

- ì‹¤ì‹œê°„ ì–‘ë°©í–¥ í†µì‹ ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” í”„ë¡œí† ì½œ
- HTTPì™€ ë‹¬ë¦¬ ì—°ê²°ì„ ìœ ì§€í•˜ë©´ì„œ í´ë¼ì´ì–¸íŠ¸-ì„œë²„ ê°„ ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ì„ ìˆ˜ ìˆìŒ

| ë¹„êµ í•­ëª© | HTTP | WebSocket |
| --- | --- | --- |
| ì—°ê²° ë°©ì‹ | ìš”ì²­-ì‘ë‹µ | ì§€ì†ì  ì—°ê²° |
| ì†ë„ | ìš”ì²­ë§ˆë‹¤ ì—°ê²° | ì§€ì† ì—°ê²°ë¡œ ë¹ ë¦„ |
| ë°ì´í„° êµí™˜ | í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­í•´ì•¼ ì„œë²„ ì‘ë‹µ | ì‹¤ì‹œê°„ ì–‘ë°©í–¥ í†µì‹  |

### 2. Django Channelsë¥¼ ì´ìš©í•œ ì›¹ì†Œì¼“ êµ¬í˜„

1.  ì„¤ì¹˜ ë° ì„¤ì •
    
    ```bash
    pip install channels channels-redis
    ```
    
- `settings.py`
    
    ```python
    INSTALLED_APPS = [
        'channels',
        'myapp',
    ]
    
    ASGI_APPLICATION = "myproject.asgi.application"
    CHANNEL_LAYERS = {
        "default": {
            "BACKEND": "channels_redis.core.RedisChannelLayer",
            "CONFIG": {
                "hosts": ["redis://localhost:6379"],
            },
        },
    }
    ```
    
- `asgi.py`
    
    ```python
    import os
    from django.core.asgi import get_asgi_application
    from channels.routing import ProtocolTypeRouter, URLRouter
    import myapp.routing
    
    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'myproject.settings')
    
    application = ProtocolTypeRouter({
        "http": get_asgi_application(),
        "websocket": URLRouter(
            myapp.routing.websocket_urlpatterns
        ),
    })
    ```
    
- `routing.py`
    
    ```python
    from django.urls import path
    from myapp.consumers import ChatConsumer
    
    websocket_urlpatterns = [
        path("ws/chat/", ChatConsumer.as_asgi()),
    ]
    ```
    
- `consumers.py`
    
    ```python
    import json
    from channels.generic.websocket import AsyncWebsocketConsumer
    
    class ChatConsumer(AsyncWebsocketConsumer):
        async def connect(self):
            await self.accept()
            await self.send(text_data=json.dumps({"message": "ì—°ê²° ì„±ê³µ"}))
    
        async def disconnect(self, close_code):
            pass
    
        async def receive(self, text_data):
            data = json.loads(text_data)
            message = data["message"]
            await self.send(text_data=json.dumps({"message": message}))
    ```
    

<br>

## Redisë¥¼ í™œìš©í•œ ë‹¤ì¤‘ ì„œë²„ ì›¹ì†Œì¼“ ìš´ì˜

- ì—¬ëŸ¬ ëŒ€ì˜ ì„œë²„ì—ì„œ ì›¹ì†Œì¼“ì„ ì²˜ë¦¬í•  ê²½ìš° Redisë¥¼ ì´ìš©í•˜ì—¬ ë©”ì‹œì§€ë¥¼ ë¸Œë¡œë“œìºìŠ¤íŠ¸
- `channels_redis`ë¥¼ ì„¤ì •í•˜ì—¬ ì—¬ëŸ¬ ì„œë²„ ê°„ ë™ê¸°í™” ê°€ëŠ¥

<br>

## ë¹„ë™ê¸° ì²˜ë¦¬ì˜ í•œê³„ì™€ ì£¼ì˜í•  ì 

1. **CPU ë°”ìš´ë“œ ì‘ì—…**
    - ë¹„ë™ê¸°ëŠ” ì£¼ë¡œ I/O ì‘ì—…ì— ì í•©í•˜ë©°, CPU ì‘ì—…ì´ ë§ë‹¤ë©´ `multiprocessing`ì´ í•„ìš”
2. **ë™ê¸°-ë¹„ë™ê¸° í˜¼í•© ì£¼ì˜**
    - ë¹„ë™ê¸° ì½”ë“œ ë‚´ë¶€ì—ì„œ ë™ê¸° í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë©´ ì„±ëŠ¥ ì €í•˜ ë°œìƒ ê°€ëŠ¥
3. **ë°ë“œë½ ë°œìƒ ê°€ëŠ¥**
    - ì˜ëª»ëœ `await` ì‚¬ìš©ìœ¼ë¡œ ì¸í•´ í”„ë¡œê·¸ë¨ì´ ë©ˆì¶œ ìˆ˜ ìˆìŒ
4. **ì˜¤ë²„í—¤ë“œ**: 
    - ë¹„ë™ê¸° ì‹¤í–‰ì„ ìœ„í•œ ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­ ë¹„ìš© ì¡´ì¬

<br>
<br>

# ğŸ’¡Today I Thought

## ì˜¤ëŠ˜ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [x] ì•Œê³ ë¦¬ì¦˜ ì½”ë“œì¹´íƒ€ 1ë¬¸ì œ
- [x] SQL ì½”ë“œì¹´íƒ€ 1ë¬¸ì œ
- [x] ìœ ì €í…ŒìŠ¤íŠ¸ ì •ë¦¬
- [x] ë¸Œë¡œì…” ìˆ˜ì •
- [x] PickMate ì„ì‹œ FE ì‘ì„±
- [x] TIL ì‘ì„±

## íšŒê³ 
&nbsp;ì˜¤ëŠ˜ ì—„ë§ˆ ìƒì‹ ì´ì…”ê°€ì§€êµ¬ ë§ì´ ëª»í•´ì„œ ì¡°ê¸ˆ ë¶ˆì•ˆí•œ ì–´ë¥¸.. ë‚´ì¼ ë°¤ìƒ˜í•  ê²ƒ ê°™ì€ ì´ìƒí•œ ëŠë‚Œ..ã… ì´ì œë¶€í„° ë­ ë°¤ìƒˆì„œë¼ë„ í•´ë‚´ì•¼ì§€...ğŸ¥º ì¼ì • ë„ˆë¬´ë„ˆë¬´ë„ˆë¬´ë„ˆë¬´ ë¹¡ì„¸ë‹¤ã… ã…  ìœ ì €í…ŒìŠ¤íŠ¸ í”¼ë“œë°±ë„ ë°˜ì˜í•´ì•¼í•˜ëŠ”ë°...
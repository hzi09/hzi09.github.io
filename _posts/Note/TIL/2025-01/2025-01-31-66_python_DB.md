---
title:  "[TIL] ë‚´ì¼ë°°ì›€ìº í”„ 66ì¼ì°¨_[Python] DBì— ë°ì´í„° ì €ì¥ - MySQL" 

categories: 
    - TIL
tags: 
    - TIL
    - ë‚´ì¼ë°°ì›€ìº í”„
    - Python
    - MySQL
    - DB


toc: True
toc_sticky: True
---

![TIL](/assets/images/TIL2.png){: .align-center style="width:35%;"}

# ğŸ‘€Today I Learn
## pymysql ì„¤ì¹˜í•˜ê¸°
- Pythonì—ì„œ MySQL ë°ì´í„°ë² ì´ìŠ¤ì™€ ìƒí˜¸ ì‘ìš©í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬
- MySQL ì„œë²„ì™€ ì—°ê²°í•˜ê³ , ë°ì´í„°ë¥¼ ì‚½ì…/ì¡°íšŒ/ìˆ˜ì •/ì‚­ì œí•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µ

    ```bash
    pip install pymysql
    ```

### MySQLì— ì—°ê²°í•˜ê¸°
```python
import pymysql

# MySQL ì—°ê²°
conn = pymysql.connect(
    host='localhost',    # MySQL ì„œë²„ ì£¼ì†Œ
    user='root',         # MySQL ì‚¬ìš©ì ì´ë¦„
    password='1234',     # MySQL ë¹„ë°€ë²ˆí˜¸
    db='testdb',         # ì‚¬ìš©í•  ë°ì´í„°ë² ì´ìŠ¤
    charset='utf8mb4',   # í•œê¸€ ì§€ì›
    autocommit=True      # ìë™ ì»¤ë°‹ ì„¤ì •
)


print("MySQL ì—°ê²° ì„±ê³µ!")
conn.close()
```

### ê¸°ëŠ¥ ì‚´í´ë³´ê¸°

| ê¸°ëŠ¥                | SQL ë¬¸                                   | pymysql ì½”ë“œ                                |
|:-------------------:|:----------------------------------------:|:-------------------------------------------:|
| ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±   | `CREATE DATABASE db_name;`               | `cursor.execute("CREATE DATABASE db_name")` |
| í…Œì´ë¸” ìƒì„±         | `CREATE TABLE table_name (...);`         | `cursor.execute("CREATE TABLE ...")`        |
| ë°ì´í„° ì‚½ì…         | `INSERT INTO table VALUES (...);`        | `cursor.execute("INSERT INTO ...")`         |
| ì—¬ëŸ¬ ê°œ ë°ì´í„° ì‚½ì… | `INSERT INTO table VALUES (...), (...);` | `cursor.executemany("INSERT INTO ...")`     |
| ë°ì´í„° ì¡°íšŒ          | `SELECT * FROM table;`                  | `cursor.fetchall()`                         |
| ë°ì´í„° ìˆ˜ì •         | `UPDATE table SET col=value WHERE ...;`  | `cursor.execute("UPDATE ...")`              |
| ë°ì´í„° ì‚­ì œ         | `DELETE FROM table WHERE ...;`           | `cursor.execute("DELETE ...")`              |

- ì´ë ‡ê²Œ ì‚¬ìš©í•˜ë©´ ë¨!

    ```python
    try:
        with conn.cursor() as cursor:
            sql = "ì—¬ê¸°ì—ë‹¤ê°€ ìœ„ì˜ ì½”ë“œë¥¼ ë„£ì–´ì„œ ì‚¬ìš©í•˜ë©´ ë¨"
            cursor.execute(sql)

    finally:
        conn.close()
    ```

### âš ï¸ì£¼ì˜í•  ì !
1. MySQL ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸
    - MySQL ì„œë¹„ìŠ¤ ì‹œì‘ í›„ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤.
    - ìœˆë„ìš°: net start mysql
    - ë¦¬ëˆ…ìŠ¤/ë§¥: sudo systemctl start mysql

2. SQL ì¸ì ì…˜ ë°©ì§€ë¥¼ ìœ„í•´ execute()ì— ì§ì ‘ ë³€ìˆ˜ë¥¼ ë„£ì§€ ë§ ê²ƒ

    ```python
    cursor.execute("INSERT INTO users (name, age) VALUES (%s, %s)", (name, age))
    ```

- âŒ ì´ë ‡ê²Œ í•˜ë©´ ì•ˆë¨:

    ```python
    cursor.execute(f"INSERT INTO users (name, age) VALUES ('{name}', {age})")  # SQL Injection ìœ„í—˜
    ```

3. ìë™ ì»¤ë°‹(autocommit=True)ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ conn.commit()ì„ í•´ì¤˜ì•¼ í•¨

    ```python
    conn.commit()
    ```

4. ì—°ê²°ì„ ë‹«ì•„ì•¼ í•¨
   - ì‚¬ìš© í›„ ë°˜ë“œì‹œ conn.close()ë¥¼ í˜¸ì¶œí•˜ì—¬ ë¦¬ì†ŒìŠ¤ë¥¼ í•´ì œí•  ê²ƒ

    ```python
    conn.close()
    ```


<br>


## MySQL ì‚¬ìš©í•´ë³´ê¸°
### 1. ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±í•˜ê¸°
```python
import pymysql

# MySQL ì„œë²„ì— ì—°ê²° (ë°ì´í„°ë² ì´ìŠ¤ ì—†ì´ ì—°ê²°)
conn = pymysql.connect(
    host='localhost',
    user='root',
    password='1234',
    charset='utf8mb4',
    autocommit=True  # ìë™ ì»¤ë°‹ ì„¤ì •
)

try:
    with conn.cursor() as cursor:
        # ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
        sql = "CREATE DATABASE IF NOT EXISTS kobis CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;"
        cursor.execute(sql)

finally:
    conn.close()  # ì—°ê²° ì¢…ë£Œ
```

- ì‹¤í–‰í•˜ê³  DBë¥¼ í™•ì¸í•´ë³´ë©´ 'kobis' ë°ì´í„°ë² ì´ìŠ¤ê°€ ìƒê²¼ìŒ!

  ![Image](https://github.com/user-attachments/assets/ca3cb9e1-9798-45a6-8c51-2c41c2c8a6b9){: style="width:40%;"}

- í…Œì´ë¸”ì€ ë”°ë¡œ ë„£ì–´ì¤€ê²Œ ì—†ê¸° ë•Œë¬¸ì— í……í…… ë¹„ì–´ìˆëŠ” DBê°€ ìƒì„±ë˜ì–´ ìˆìŒ
- í…Œì´ë¸”ì„ ìƒì„±í•´ë³´ì!


### 2. í…Œì´ë¸” ìƒì„±í•˜ê¸°
```python
import pymysql

# MySQL 'kobis' ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°
conn = pymysql.connect(
    host='localhost',
    user='root',
    password='1234',
    db='kobis',
    charset='utf8mb4',
    autocommit=True
)

try:
    with conn.cursor() as cursor:
        # í…Œì´ë¸” ìƒì„± SQL
        sql = """
        CREATE TABLE IF NOT EXISTS results (
            id INT AUTO_INCREMENT PRIMARY KEY,
            name VARCHAR(255) NOT NULL,
            score FLOAT NOT NULL,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        );
        """
        cursor.execute(sql)

finally:
    conn.close()
```

- ì‹¤í–‰í•˜ê³  ë‹¤ì‹œ DBì— ê°€ë³´ë©´ ì´ë ‡ê²Œ 'results'ë¼ëŠ” í…Œì´ë¸”ì´ ìƒì„±ëœ ê±¸ í™•ì¸í•  ìˆ˜ ìˆìŒ!

    ![Image](https://github.com/user-attachments/assets/1cd076ae-b994-4fa3-8986-f0f8207f2714){: style="width:40%;"}

- ê·¼ë° DBì™€ table ìƒì„±ì„ í•œì¤„ì— ì½”ë”©í•  ìˆ˜ëŠ” ì—†ì„ê¹Œ?ğŸ¤”
  - ë‹¹ì—°íˆ, ê°€ëŠ¥! ìœ„ì˜ ë‘ ì½”ë“œë¥¼ í•©ì³ì£¼ë©´ ëœë‹¤!


### 3. DBì™€ í…Œì´ë¸” ìƒì„±í•˜ê¸°
```python
import pymysql

# MySQL ì„œë²„ ì—°ê²° ë° DB ìƒì„±
conn = pymysql.connect(
    host='localhost',
    user='root',
    password='1234',
    charset='utf8mb4',
    autocommit=True
)

try:
    with conn.cursor() as cursor:
        # ë°ì´í„°ë² ì´ìŠ¤ ë° í…Œì´ë¸” ìƒì„±
        cursor.execute("CREATE DATABASE IF NOT EXISTS kobis1 CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;")
        cursor.execute("USE kobis1;")
        cursor.execute("""
            CREATE TABLE IF NOT EXISTS results1 (
                id INT AUTO_INCREMENT PRIMARY KEY,
                name VARCHAR(255) NOT NULL,
                score FLOAT NOT NULL,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            );
        """)


finally:
    conn.close()
```

- ì´ë ‡ê²Œ í•˜ë©´ í•œë²ˆì˜ ì½”ë“œ ì‹¤í–‰ìœ¼ë¡œ DBì™€ Tableì„ ìƒì„±í•  ìˆ˜ ìˆìŒ! 

    ![Image](https://github.com/user-attachments/assets/cbe96131-278b-4d6e-94bb-a1ba2b00ad6c){: style="width:40%;"}

### 4. DB ì‚­ì œ
```python
import pymysql

conn = pymysql.connect(
    host='localhost',
    user='root',
    password='1234',
    charset='utf8mb4',
    autocommit=True
)

try:
    with conn.cursor() as cursor:
        cursor.execute("DROP DATABASE IF EXISTS kobis1;")
finally:
    conn.close()
```

<br>

## ì˜ˆì œ
- Pythonì—ì„œ í•™ìƒì˜ ì‹œí—˜ ì ìˆ˜ ê³„ì‚°ì„ ìˆ˜í–‰í•œ í›„, ê·¸ ê²°ê³¼ê°’ì„ MySQL í…Œì´ë¸”ì— ì €ì¥

```python
import pymysql

# MySQL ì„œë²„ ì—°ê²° ë° DB ìƒì„±
conn = pymysql.connect(
    host='localhost',
    user='root',
    password='1234',
    charset='utf8mb4',
    autocommit=True
)

try:
    with conn.cursor() as cursor:
        # 1. ë°ì´í„°ë² ì´ìŠ¤ ë° í…Œì´ë¸” ìƒì„±
        cursor.execute("CREATE DATABASE IF NOT EXISTS kobis CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;")
        cursor.execute("USE kobis;")
        cursor.execute("""
            CREATE TABLE IF NOT EXISTS results (
                id INT AUTO_INCREMENT PRIMARY KEY,
                name VARCHAR(255) NOT NULL,
                score FLOAT NOT NULL,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            );
        """)

        # 2. í•™ìƒë“¤ì˜ ì ìˆ˜ ì…ë ¥
        students = [
            ("Bob", [78, 82, 80]),
            ("Charlie", [95, 92, 88]),
            ("David", [60, 70, 65])
        ]
        
        # 3. í‰ê·  ì ìˆ˜ ê³„ì‚° í›„ MySQLì— ì €ì¥
        sql = "INSERT INTO results (name, score) VALUES (%s, %s)"
        values = [(name, sum(scores)/len(scores)) for name, scores in students]

        cursor.executemany(sql, values)


finally:
    conn.close()
```

![Image](https://github.com/user-attachments/assets/4a05449d-dd2a-4e41-9fee-fdf4262031e7){: style="width:40%;"}

<br>
<br>

# ğŸ’¡Today I Thought

## ì˜¤ëŠ˜ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [x] 

## íšŒê³ 
&nbsp; 
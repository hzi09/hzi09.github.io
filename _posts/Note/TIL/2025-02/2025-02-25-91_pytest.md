---
title:  "[TIL] ë‚´ì¼ë°°ì›€ìº í”„ 91ì¼ì°¨_[Python] í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬(pytest)" 

categories: 
    - TIL
tags: 
    - TIL
    - ë‚´ì¼ë°°ì›€ìº í”„
    - Python
    - pytest


toc: True
toc_sticky: True
---

![TIL](/assets/images/TIL2.png){: .align-center style="width:35%;"}

# ğŸ‘€Today I Learn
## pytestë€?
- pytestëŠ” Pythonì—ì„œ ê°€ì¥ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ ì¤‘ í•˜ë‚˜
- ê°„ê²°í•œ ë¬¸ë²•ê³¼ ê°•ë ¥í•œ ê¸°ëŠ¥ì„ ì œê³µí•˜ë©°, ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¶€í„° ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ê¹Œì§€ ë‹¤ì–‘í•œ í…ŒìŠ¤íŠ¸ë¥¼ ì‰½ê²Œ ì‘ì„±í•  ìˆ˜ ìˆìŒ

### pytestì˜ ì¥ì 
- ì„¤ì¹˜ ë° ì‚¬ìš©ì´ ê°„í¸: `pip install pytest`ë¡œ ì‰½ê²Œ ì„¤ì¹˜ ê°€ëŠ¥
- ê°„ê²°í•œ ë¬¸ë²•: `assert` ë¬¸ì„ í™œìš©í•œ ì§ê´€ì ì¸ í…ŒìŠ¤íŠ¸ ì‘ì„±
- ê°•ë ¥í•œ í™•ì¥ì„±: `fixture`, `parameterization` ë“± ë‹¤ì–‘í•œ ê¸°ëŠ¥ ì œê³µ
- í…ŒìŠ¤íŠ¸ ìë™ ê²€ìƒ‰: `test_`ë¡œ ì‹œì‘í•˜ëŠ” í•¨ìˆ˜ ë˜ëŠ” `Test` í´ë˜ìŠ¤ë¥¼ ìë™ìœ¼ë¡œ ì¸ì‹
- ê°•ë ¥í•œ í”ŒëŸ¬ê·¸ì¸ ì§€ì›: `pytest-cov`(ì½”ë“œ ì»¤ë²„ë¦¬ì§€), `pytest-django`(Django í…ŒìŠ¤íŠ¸) ë“± ë‹¤ì–‘í•œ í”ŒëŸ¬ê·¸ì¸ í™œìš© ê°€ëŠ¥

<br>

## pytest ì„¤ì¹˜ ë° ê¸°ë³¸ ì‚¬ìš©ë²•
### ì„¤ì¹˜ ë°©ë²•
```bash
pip install pytest
```

### ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±
- pytestì—ì„œëŠ” assert ë¬¸ì„ í™œìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±

    ```python
    # test_sample.py
    def test_addition():
        assert 1 + 2 == 3

    def test_string():
        assert "hello".upper() == "HELLO"
    ```

### í…ŒìŠ¤íŠ¸ ì‹¤í–‰
```bash
pytest test_sample.py

# í˜„ì¬ ë””ë ‰í† ë¦¬ì˜ ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰ :
pytest
```

- ê²°ê³¼ ì˜ˆì‹œ

    ``
    ============================= test session starts =============================
    collected 2 items

    test_sample.py ..                                                       [100%]

    ============================== 2 passed in 0.12s ==============================
    ```

<br>

## pytest Fixture í™œìš©í•˜ê¸°
- pytestì˜ fixtureëŠ” ë°˜ë³µë˜ëŠ” ì„¤ì • ì‘ì—…ì„ ì¤„ì´ê³ , í…ŒìŠ¤íŠ¸ ê°„ ì˜ì¡´ì„±ì„ íš¨ê³¼ì ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ê¸°ëŠ¥

### ê¸°ë³¸ ì‚¬ìš© ì˜ˆì œ
```python
import pytest

@pytest.fixture
def sample_data():
    return {"name": "pytest", "type": "testing"}

def test_sample_data(sample_data):
    assert sample_data["name"] == "pytest"
    assert sample_data["type"] == "testing"
```

- `@pytest.fixture`ë¥¼ ì‚¬ìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸ì— í•„ìš”í•œ ë°ì´í„°ë¥¼ ì„¤ì •
- `test_sample_data` í•¨ìˆ˜ì—ì„œ `sample_data`ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„ ì‚¬ìš©

### Fixtureì˜ Scope ì„¤ì •
- ê¸°ë³¸ì ìœ¼ë¡œ fixtureëŠ” ê° í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë§ˆë‹¤ ì‹¤í–‰ë˜ì§€ë§Œ, scopeë¥¼ ì§€ì •í•˜ì—¬ ì‹¤í–‰ ë²”ìœ„ë¥¼ ì¡°ì •í•  ìˆ˜ ìˆìŒ

    ```python
    @pytest.fixture(scope="module")  # í•œ ëª¨ë“ˆì—ì„œ í•œ ë²ˆë§Œ ì‹¤í–‰
    ```

    - `function` (ê¸°ë³¸ê°’): ê° í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë§ˆë‹¤ ì‹¤í–‰
    - `module`: ëª¨ë“ˆ ë‚´ì—ì„œ í•œ ë²ˆë§Œ ì‹¤í–‰
    - `session`: ì „ì²´ í…ŒìŠ¤íŠ¸ì—ì„œ í•œ ë²ˆë§Œ ì‹¤í–‰

<br>

## pytestì—ì„œ Mocking ì‚¬ìš©í•˜ê¸°
- ì™¸ë¶€ API í˜¸ì¶œ, ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ë“± ì‹¤ì œ í™˜ê²½ê³¼ ë¶„ë¦¬í•˜ì—¬ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ Mockingì´ í•„ìš” 
- pytestì—ì„œëŠ” unittest.mock ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™œìš©í•˜ì—¬ Mockingì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŒ

### Mock ê°ì²´ í™œìš© ì˜ˆì œ
```python
from unittest.mock import MagicMock

def test_mocked_function():
    mock_function = MagicMock(return_value=10)
    assert mock_function() == 10
    mock_function.assert_called_once()
```
- `MagicMock(return_value=10)`: ê°€ì§œ í•¨ìˆ˜(mock function)ë¥¼ ìƒì„±í•˜ê³ , í˜¸ì¶œ ì‹œ 10ì„ ë°˜í™˜
- `mock_function.assert_called_once()`: í•´ë‹¹ í•¨ìˆ˜ê°€ í•œ ë²ˆ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ ê²€ì¦

<br>

## íŒŒë¼ë¯¸í„°í™” í…ŒìŠ¤íŠ¸ (Parameterized Test)
-ë™ì¼í•œ í…ŒìŠ¤íŠ¸ë¥¼ ì—¬ëŸ¬ ê°œì˜ ì…ë ¥ê°’ì— ëŒ€í•´ ë°˜ë³µì ìœ¼ë¡œ ì‹¤í–‰í•  ë•Œ `@pytest.mark.parametrize`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ

### ì—¬ëŸ¬ ê°œì˜ ì…ë ¥ê°’ í…ŒìŠ¤íŠ¸ ì˜ˆì œ
```python
import pytest

@pytest.mark.parametrize("a, b, result", [(1, 2, 3), (2, 3, 5), (3, 5, 8)])
def test_addition(a, b, result):
    assert a + b == result
```
- `@pytest.mark.parametrize("ë³€ìˆ˜ëª…", [(ê°’1, ê°’2, ê²°ê³¼), (ê°’3, ê°’4, ê²°ê³¼)])`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤ì–‘í•œ ì¼€ì´ìŠ¤ë¥¼ í…ŒìŠ¤íŠ¸
- ë™ì¼í•œ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë¥¼ ì—¬ëŸ¬ ë²ˆ ì‹¤í–‰í•˜ì—¬ ê° ì…ë ¥ê°’ì„ ê²€ì¦

<br>

## ì½”ë“œ ì»¤ë²„ë¦¬ì§€ ì¸¡ì •(pytest-cov)
- í…ŒìŠ¤íŠ¸ê°€ ì½”ë“œì˜ ëª‡ í¼ì„¼íŠ¸ë¥¼ ì‹¤í–‰í–ˆëŠ”ì§€ í™•ì¸í•˜ë ¤ë©´ pytest-cov í”ŒëŸ¬ê·¸ì¸ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ

### ì„¤ì¹˜ ë° ì‹¤í–‰ ë°©ë²•
```bash
pip install pytest-cov
pytest --cov=your_module_name
```

- í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì˜ˆì‹œ

    ```
    ----------- coverage: platform linux, python 3.10 -----------
    Name              Stmts   Miss  Cover
    -------------------------------------
    your_module.py      10      2    80%
    ```

    - `Stmts`: ì´ ì‹¤í–‰ëœ ì½”ë“œ ì¤„ ìˆ˜
    - `Miss`: í…ŒìŠ¤íŠ¸ë˜ì§€ ì•Šì€ ì½”ë“œ ì¤„ ìˆ˜
    - `Cover`: ì½”ë“œ ì»¤ë²„ë¦¬ì§€ ë¹„ìœ¨

<br>

## pytestë¥¼ í™œìš©í•œ ì‹¤ì „ í…ŒìŠ¤íŠ¸ ì˜ˆì œ
### Djangoì—ì„œ pytest í™œìš©
- Django í”„ë¡œì íŠ¸ì—ì„œ pytestë¥¼ í™œìš©í•˜ë ¤ë©´ pytest-djangoë¥¼ ì„¤ì¹˜í•´ì•¼ í•¨

    ```bash
    pip install pytest-django
    ```

- ì„¤ì¹˜ í›„ `pytest.ini` íŒŒì¼ì„ ìƒì„±í•˜ì—¬ Django ì„¤ì •ì„ ì§€ì •

    ```
    [pytest]
    DJANGO_SETTINGS_MODULE = myproject.settings
    ```

- Djangoì˜ ORMì„ í™œìš©í•œ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±

    ```python
    import pytest
    from myapp.models import User

    @pytest.mark.django_db
    def test_create_user():
        user = User.objects.create(username="testuser", email="test@example.com")
        assert user.username == "testuser"
    ```

- API í…ŒìŠ¤íŠ¸ (FastAPI + HTTPX í™œìš©)

    ```python
    from fastapi.testclient import TestClient
    from myapi import app

    client = TestClient(app)

    def test_read_main():
        response = client.get("/")
        assert response.status_code == 200
        assert response.json() == {"message": "Hello, World!"}
    ```


<br>
<br>

# ğŸ’¡Today I Thought

## ì˜¤ëŠ˜ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [x] ì•Œê³ ë¦¬ì¦˜ ì½”ë“œì¹´íƒ€ 1ë¬¸ì œ
- [x] SQL ì½”ë“œì¹´íƒ€ 1ë¬¸ì œ
- [x] íŠ¸ëŸ¬ë¸” ìŠˆíŒ… í•´ê²°
- [x] ë°œí‘œ ìë£Œ ì‘ì„±
- [x] TIL ì‘ì„± 

## íšŒê³ 
&nbsp;ìš°ë¦¬íŒ€ ë‹¤ ì˜í–ˆëŠ”ë° GitHub Actions CI ìë™í™”ê°€ ì˜ ì•ˆë˜ì„œ í•´ë³´ë ¤ê³  ê³µë¶€í–ˆëŠ”ë°, ê·¸ë˜ë„ í•´ê²°ì€ ëª»í–ˆë‹¤. ë„ëŒ€ì²´ ë­ê°€ ë¬¸ì œì§€..ğŸ«  envë‘ tomlë•Œë¬¸ì— í—·ê°ˆë ¤ì„œ ë” ì˜ ì•ˆë˜ëŠ”ê±° ê°™ê¸°ë‘.. ì´ê±´ ì‹œê°„ë‚´ì„œ í•´ê²°ë´ì•¼í•  ê²ƒ ê°™ë‹¤.